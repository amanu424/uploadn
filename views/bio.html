<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Biometric Scanner Pro</title>
    <link rel="stylesheet" href="/biometrics.css" type="text/css" media="all" />
  </head>
  <body>
    <div class="container">
      <h1>Biometric Scanner</h1>
      <p class="description">
        Secure your identity with our advanced face and fingerprint scanning
        technology. Complete both scans to proceed.
      </p>
      <div class="scanner-section">
        <h2>Face Scanner</h2>
        <div id="faceScanner">
          <img
            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z'%3E%3C/path%3E%3Ccircle cx='12' cy='13' r='4'%3E%3C/circle%3E%3C/svg%3E"
            alt="Camera"
          />
        </div>
        <div class="button-group">
          <button id="startFaceScan" class="button">Start Face Scan</button>
          <button id="submitFaceScan" class="button" style="display: none">
            Submit
          </button>
          <button
            id="retryFaceScan"
            class="button secondary"
            style="display: none"
          >
            Retry
          </button>
        </div>
        <div
          id="faceSuccessMessage"
          class="success-message"
          style="display: none"
        >
          Photo Submitted
        </div>
      </div>
      <hr />

      <div class="scanner-section">
        <h2>Fingerprint Scanner</h2>
        <p>Place your finger on the scanner to verify your identity</p>
        <div class="scanner-container">
          <div
            id="scanner"
            class="scanner"
            tabindex="0"
            role="button"
            aria-label="Fingerprint scanner"
          >
            <svg
              class="fingerprint"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.25.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.26-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.7-3.4 2.96-.08.14-.23.21-.39.21zm6.25 12.07c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.23-1.05-2.73-1.05-4.34 0-2.97 2.54-5.39 5.66-5.39s5.66 2.42 5.66 5.39c0 .28-.22.5-.5.5s-.5-.22-.5-.5c0-2.42-2.09-4.39-4.66-4.39-2.57 0-4.66 1.97-4.66 4.39 0 1.44.32 2.77.93 3.85.64 1.15 1.08 1.64 1.85 2.42.19.2.19.51 0 .71-.11.1-.24.15-.37.15zm7.17-1.85c-1.19 0-2.24-.3-3.1-.89-1.49-1.01-2.38-2.65-2.38-4.39 0-.28.22-.5.5-.5s.5.22.5.5c0 1.41.72 2.74 1.94 3.56.71.48 1.54.71 2.54.71.24 0 .64-.03 1.04-.1.27-.05.53.13.58.41.05.27-.13.53-.41.58-.57.11-1.07.12-1.21.12zM14.91 22c-.04 0-.09-.01-.13-.02-1.59-.44-2.63-1.03-3.72-2.1-1.4-1.39-2.17-3.24-2.17-5.22 0-1.62 1.38-2.94 3.08-2.94 1.7 0 3.08 1.32 3.08 2.94 0 1.07.93 1.94 2.08 1.94s2.08-.87 2.08-1.94c0-3.77-3.25-6.83-7.25-6.83-2.84 0-5.44 1.58-6.61 4.03-.39.81-.59 1.76-.59 2.8 0 .78.07 2.01.67 3.61.1.26-.03.55-.29.64-.26.1-.55-.04-.64-.29-.49-1.31-.73-2.61-.73-3.96 0-1.2.23-2.29.68-3.24 1.33-2.79 4.28-4.6 7.51-4.6 4.55 0 8.25 3.51 8.25 7.83 0 1.62-1.38 2.94-3.08 2.94s-3.08-1.32-3.08-2.94c0-1.07-.93-1.94-2.08-1.94s-2.08.87-2.08 1.94c0 1.71.66 3.31 1.87 4.51.95.94 1.86 1.46 3.27 1.85.27.07.42.35.35.61-.05.23-.26.38-.47.38z"
              />
            </svg>
            <svg
              class="checkmark"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              style="display: none"
            >
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>
            <svg class="progress-ring" width="120" height="120">
              <circle
                class="progress-ring__circle"
                stroke-width="4"
                fill="transparent"
                r="58"
                cx="60"
                cy="60"
              />
            </svg>
          </div>
          <div class="progress-bar">
            <div class="progress-bar__fill"></div>
          </div>
          <div id="message" class="message" aria-live="polite"></div>
        </div>
      </div>
      <button id="completeButton">Submit</button>
    </div>
    <script>
      const faceScanner = document.getElementById("faceScanner");
      const startFaceScanBtn = document.getElementById("startFaceScan");
      const submitFaceScanBtn = document.getElementById("submitFaceScan");
      const retryFaceScanBtn = document.getElementById("retryFaceScan");
      const completeButton = document.getElementById("completeButton");
      let stream;
      let isFaceScanning = false;
      let capturedImage;
      let fingerprintTimer;
      let faceScanned = false;
      let fingerprintScanned = false;

      startFaceScanBtn.addEventListener("click", startFaceScanner);
      submitFaceScanBtn.addEventListener("click", submitFaceScan);
      retryFaceScanBtn.addEventListener("click", retryFaceScan);
      completeButton.addEventListener("click", () =>
        window.location.href = "/done"
      );

      function updateCompleteButton() {
        if (faceScanned && fingerprintScanned) {
          completeButton.style.display = "block";
        }
      }

      async function startFaceScanner() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: true });
          const video = document.createElement("video");
          video.srcObject = stream;
          video.autoplay = true;
          faceScanner.innerHTML = "";
          faceScanner.appendChild(video);
          isFaceScanning = true;
          startFaceScanBtn.textContent = "Capture Photo";
          video.onloadedmetadata = () => {
            video.play();
          };
          startFaceScanBtn.removeEventListener("click", startFaceScanner);
          startFaceScanBtn.addEventListener("click", capturePhoto);
        } catch (err) {
          console.error("Error accessing the camera:", err);
        }
      }

      function capturePhoto() {
        const video = faceScanner.querySelector("video");
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        capturedImage = canvas;
        faceScanner.innerHTML = "";
        faceScanner.appendChild(canvas);
        startFaceScanBtn.style.display = "none";
        submitFaceScanBtn.style.display = "block";
        retryFaceScanBtn.style.display = "block";
      }

      function submitFaceScan() {
        faceSuccessMessage.style.display = "flex";
        submitFaceScanBtn.style.display = "none";
        retryFaceScanBtn.style.display = "none";
        faceScanned = true;
        updateCompleteButton();
        setTimeout(() => {
          faceSuccessMessage.style.display = "none";
          startFaceScanBtn.style.display = "block";
          startFaceScanBtn.textContent = "Start Face Scan";
          faceScanner.innerHTML =
            "<img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z'%3E%3C/path%3E%3Ccircle cx='12' cy='13' r='4'%3E%3C/circle%3E%3C/svg%3E\" alt=\"Camera\">";
          startFaceScanBtn.removeEventListener("click", capturePhoto);
          startFaceScanBtn.addEventListener("click", startFaceScanner);
        }, 3000);
      }

      function retryFaceScan() {
        startFaceScanner();
        submitFaceScanBtn.style.display = "none";
        retryFaceScanBtn.style.display = "none";
        startFaceScanBtn.style.display = "block";
        startFaceScanBtn.textContent = "Capture Photo";
      }

    const scanner = document.getElementById('scanner');
    const message = document.getElementById('message');
    const progressRing = document.querySelector('.progress-ring__circle');
    const progressBar = document.querySelector('.progress-bar__fill');
    const fingerprintIcon = document.querySelector('.fingerprint');
    const checkmarkIcon = document.querySelector('.checkmark');
    const radius = progressRing.r.baseVal.value;
    const circumference = radius * 2 * Math.PI;
    let isScanning = false;
    let scanProgress = 0;
    let scanInterval;

    progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
    progressRing.style.strokeDashoffset = circumference;

    function setProgress(percent) {
        const offset = circumference - percent / 100 * circumference;
        progressRing.style.strokeDashoffset = offset;
        progressBar.style.width = `${percent}%`;
    }

    function startScan() {
        if (!isScanning) {
            isScanning = true;
            scanProgress = 0;
            scanner.classList.add('scanning');
            scanner.classList.remove('success');
            fingerprintIcon.style.display = 'block';
            checkmarkIcon.style.display = 'none';
            message.textContent = 'Scanning...';
            message.style.color = 'var(--accent-color)';
            scanInterval = setInterval(updateScanProgress, 30);
        }
    }

    function stopScan() {
        if (isScanning) {
            isScanning = false;
            clearInterval(scanInterval);
            scanner.classList.remove('scanning');
            fingerprintIcon.style.display = 'block';
            checkmarkIcon.style.display = 'none';
            message.textContent = 'Scan interrupted';
            message.style.color = 'var(--secondary-color)';
            setProgress(0);
        }
    }

    function updateScanProgress() {
        scanProgress += 1;
        setProgress(scanProgress);
        if (scanProgress >= 100) {
            fingerprintScanned = true
            updateCompleteButton()
            clearInterval(scanInterval);
            isScanning = false;
            scanner.classList.remove('scanning');
            scanner.classList.add('success');
            fingerprintIcon.style.display = 'none';
            checkmarkIcon.style.display = 'block';
            message.textContent = 'Authentication successful';
            message.style.color = 'var(--success-color)';
        }
    }

    scanner.addEventListener('mousedown', startScan);
    scanner.addEventListener('mouseup', stopScan);
    scanner.addEventListener('mouseleave', stopScan);
    scanner.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startScan();
    });
    scanner.addEventListener('touchend', stopScan);

    // Keyboard accessibility
    scanner.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            startScan();
        }
    });
    scanner.addEventListener('keyup', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            stopScan();
        }
    });
    </script>
  </body>
</html>